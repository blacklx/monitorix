# Environment Variables Guide

## What MUST be in .env?

### Critical (MUST be present)

1. **Database Configuration**
   - `POSTGRES_USER` - Database username (default: `monitorix`)
   - `POSTGRES_PASSWORD` - Database password (auto-generated)
   - `POSTGRES_DB` - Database name (default: `monitorix`)
   - `DATABASE_URL` - Full database connection string
   - **Why**: Required to connect to PostgreSQL

2. **Security**
   - `SECRET_KEY` - For JWT token signing (auto-generated)
   - **Why**: Used to sign and verify JWT tokens

### Admin User Configuration

3. **Admin User Creation**
   - `ADMIN_USERNAME` - Admin username (default: `admin`)
   - `ADMIN_EMAIL` - Admin email (default: `admin@monitorix.local`)
   - **Important**: `ADMIN_PASSWORD` is NOT in .env
   - **Why**: Password is generated by backend and shown in installation summary
   - **After creation**: Password is stored (hashed) in PostgreSQL database
   - **Security**: Password is only shown in summary after installation - user's responsibility to save it

### Configuration (recommended)

4. **Proxmox**
   - `PROXMOX_NODES` - Proxmox node configuration
   - `PROXMOX_VERIFY_SSL` - SSL verification (default: `true`)
   - `PROXMOX_CA_BUNDLE` - Custom CA bundle (optional)

5. **Frontend**
   - `FRONTEND_URL` - Frontend URL for password reset links
   - `REACT_APP_API_URL` / `VITE_API_URL` - API URL for frontend

6. **CORS Configuration**
   - `CORS_ORIGINS` - Allowed origins (comma-separated, or `*` for all) - **Important**: In production, specify your frontend URL instead of `*`
   - `CORS_ALLOW_CREDENTIALS` - Allow credentials (default: `true`)
   - `CORS_ALLOW_METHODS` - Allowed HTTP methods (comma-separated, or `*` for all, default: `*`)
   - `CORS_ALLOW_HEADERS` - Allowed headers (comma-separated, or `*` for all, default: `*`)

7. **Health Checks**
   - `HEALTH_CHECK_INTERVAL` - Check interval (default: 60)
   - `HTTP_TIMEOUT` - HTTP timeout (default: 5)
   - `PING_TIMEOUT` - Ping timeout (default: 3)

8. **Email (optional)**
   - `ALERT_EMAIL_ENABLED` - Enable email alerts
   - `ALERT_EMAIL_SMTP_HOST` - SMTP server
   - `ALERT_EMAIL_SMTP_PORT` - SMTP port
   - `ALERT_EMAIL_SMTP_USER` - SMTP username
   - `ALERT_EMAIL_SMTP_PASSWORD` - SMTP password
   - `ALERT_EMAIL_FROM` - Sender email
   - `ALERT_EMAIL_TO` - Recipient email

9. **Metrics**
   - `METRICS_RETENTION_DAYS` - How long metrics are stored (default: 30)
   - `METRICS_CLEANUP_ENABLED` - Enable automatic cleanup (default: `true`)

10. **Error Tracking - Sentry (optional)**
    - `SENTRY_ENABLED` - Enable Sentry error tracking (default: `false`)
    - `SENTRY_DSN` - Sentry DSN (Data Source Name) from Sentry project
    - `SENTRY_ENVIRONMENT` - Environment (default: `ENVIRONMENT` or `development`)
    - `SENTRY_TRACES_SAMPLE_RATE` - Performance monitoring sample rate (default: `0.1` = 10%)
    - `SENTRY_PROFILES_SAMPLE_RATE` - Profiling sample rate (default: `0.1` = 10%)

11. **Rate Limiting**
    - `RATE_LIMIT_PER_HOUR` - Requests per hour (default: `1000`)
    - `RATE_LIMIT_PER_MINUTE` - Requests per minute (default: `100`)

12. **Redis Caching (optional)**
    - `REDIS_ENABLED` - Enable Redis caching (default: `false`)
    - `REDIS_HOST` - Redis server host (default: `redis`)
    - `REDIS_PORT` - Redis server port (default: `6379`)
    - `REDIS_DB` - Redis database number (default: `0`)
    - `REDIS_PASSWORD` - Redis password (optional, default: none)
    - **Why**: Improves performance by caching frequently accessed data (dashboard stats, node/VM/service lists)
    - **Note**: If Redis is not available, the application works normally without caching

13. **Celery Background Jobs (optional)**
    - `CELERY_ENABLED` - Enable Celery for background jobs (default: `false`)
    - **Why**: Improves performance for heavy tasks by running them in background workers
    - **Note**: Requires Redis to be enabled (`REDIS_ENABLED=true`)
    - **Tasks**: Bulk operations, metrics cleanup, VM synchronization, backups, exports
    - **Note**: If Celery is not available, tasks run synchronously (slower but functional)

14. **CSRF Protection (Security)**
    - `CSRF_ENABLED` - Enable CSRF protection (default: `true`)
    - **Why**: Protects against Cross-Site Request Forgery attacks
    - **How it works**: 
      - CSRF tokens are automatically generated and stored in HTTP-only cookies
      - Frontend must include token in `X-CSRF-Token` header for all state-changing requests (POST, PUT, DELETE, PATCH)
      - Tokens are automatically handled by the frontend
    - **Note**: Can be disabled for development/testing, but should always be enabled in production

## What should NOT be in .env?

### ❌ Admin Password

**Why not:**
- Admin password is generated by backend on first creation
- Password is shown in installation summary - user's responsibility to save it
- Password is stored (hashed) in PostgreSQL database after creation
- **Security**: Password should never be in .env file

### ❌ Web UI users/passwords

**Why not:**
- Web UI users and passwords are stored in PostgreSQL database (`users` table)
- Passwords are hashed with bcrypt
- All passwords are handled by the application and stored in the database

**Where it's stored:**
- `users` table in PostgreSQL:
  - `username` - Username
  - `email` - Email
  - `hashed_password` - Hashed password (bcrypt)
  - `is_admin` - Admin status
  - `is_active` - Active status

### ❌ Other sensitive data that should be in the database

- All user data
- All application data (nodes, VMs, services, alerts, etc.)

## Summary

### MUST be in .env:
- ✅ Database credentials (to connect to database)
- ✅ SECRET_KEY (for JWT signing)
- ✅ ADMIN_USERNAME and ADMIN_EMAIL (for admin user creation)

### Should be in .env (configuration):
- ✅ Proxmox configuration
- ✅ Email configuration (if used)
- ✅ Frontend URL
- ✅ Health check settings

### Should NOT be in .env:
- ❌ ADMIN_PASSWORD (generated by backend, shown in summary)
- ❌ Web UI users/passwords (stored in database)
- ❌ Application data (stored in database)

## Example: Minimal .env

```env
# Database (MUST)
POSTGRES_USER=monitorix
POSTGRES_PASSWORD=<auto-generated>
POSTGRES_DB=monitorix
DATABASE_URL=postgresql://monitorix:<password>@postgres:5432/monitorix

# Security (MUST)
SECRET_KEY=<auto-generated>

# Admin User (auto-created on first startup)
# Note: Admin password is generated by backend and shown in installation summary
# It is NOT stored in .env for security reasons
ADMIN_USERNAME=admin
ADMIN_EMAIL=admin@monitorix.local

# Proxmox (recommended)
PROXMOX_NODES=
PROXMOX_VERIFY_SSL=true

# Frontend (recommended)
FRONTEND_URL=http://localhost:3000
```

## Example: .env after first creation

```env
# Database (MUST)
POSTGRES_USER=monitorix
POSTGRES_PASSWORD=<auto-generated>
POSTGRES_DB=monitorix
DATABASE_URL=postgresql://monitorix:<password>@postgres:5432/monitorix

# Security (MUST)
SECRET_KEY=<auto-generated>

# Admin User (can be removed after first creation if desired)
# ADMIN_USERNAME=admin
# ADMIN_EMAIL=admin@monitorix.local
# Note: ADMIN_PASSWORD is never in .env - it's generated by backend

# Proxmox
PROXMOX_NODES=node1:https://192.168.1.10:8006:user@pam:token123
PROXMOX_VERIFY_SSL=true

# Frontend
FRONTEND_URL=http://localhost:3000
```

## Security

- `.env` file has automatic `chmod 600` (only owner can read/write)
- `.env` is in `.gitignore` (not committed to Git)
- Passwords are auto-generated (not hardcoded)
- **Admin password is never in .env** - generated by backend and only shown in summary
- Web UI passwords are hashed in database (bcrypt)
